{% extends "auctions/layout.html" %}

{% block body %}
<h2>Listing: {{ listing.title }}</h2>
{% if user.is_authenticated %}
{% if not watchlist.is_watchlist %}
<form action="{% url 'listing' listing.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" name="add_watchlist" Value="Add to Watchlist">
</form>
{% else %}
<form action="{% url 'listing' listing.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" name="remove_watchlist" Value="Remove from Watchlist">
</form>
{% endif %}
{% endif %}
<img src="{{ listing.image_URL }}"><br>
<h5>{{ listing.description }}</h5>
<h2>${{ listing.bids.amount }}</h2>
{% if listing.bids.n == 0 %}
<h5>There are currently no bids for this item.</h5>
{% else %}
<h5>{{ listing.bids.n }} bid(s). Top bidder: {{ listing.bids.bidder }}</h5>
{% endif %}
{% if request.user != listing.lister and user.is_authenticated and listing.active %}
<form action="{% url 'listing' listing.pk %}" method="POST">
    {% csrf_token %}
    <h3>Place bid</h3>
    <input name="bid" type="number" step=0.01 min="{{ listing.bids.amount }}" placeholder="Bid">
    <input type="submit" value="Bid">
</form>
{% elif not listing.active %}
    {% if request.user == listing.bids.bidder %}
    <h2>The auction has ended. You are the highest bidder!</h2>
    {% else %}
    <h2>The auction has ended. Winner: {{ listing.bids.bidder }}</h2>
    {% endif %}
{% elif listing.lister == request.user %}
<form action="{% url 'listing' listing.pk %}" method="POST">
    {% csrf_token %}
    <input type="submit" name="close" value="Close Listing">
</form>
{% endif %}
<h2>Details</h2>
<ul>
    <li>Posted by {{ listing.lister }} on {{ listing.datetime }}</li>
    <li>Category: {{ listing.category }}</li>
</ul>
{% endblock %}